#!/bin/sh

# The aim of this script is to be able to run it once to set up a mac
# and again at any time to update

# TODO
# - Add all app store apps with mas
# - List apps requiring update and provide option to update or not
# - Move brew installs to a Brewfile

# Many thanks to:
# Deian Isac https://medium.com/@deianisac/how-to-quickly-set-up-a-mac-b9f89aed0dc 

# Make this script behave more like a proper language
# set -e will cause the script to bail after a command fails
# but it ignores failures inside pipelines so...
# set -o pipefail will do the same within a pipeline
# set -u will bail out if there are unset variables
# set -x will print out each command before running it
# https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/
set -euxo pipefail

# Test to see if homebrew is installed, if not install it
if test ! $(which brew)
then
  echo "  Installing Homebrew"
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" > /tmp/homebrew-install.log
fi

# Update recipies
brew update

# Update installed formulae
brew upgrade --all

# Install cask, which installs non CLI apps
brew tap caskroom/cask
brew install cask

# Install mas, an app store CLI interface
brew install mas

# Install wget, for downloading files over http/s or ftp 
brew install wget

# This wrapper around tmux allows the use of pbcopy and pbpaste
brew install reattach-to-user-namespace

# Install tree, to see file structures on the command line
brew install tree

# Install tldr, like man pages but easier to grok
brew install tldr

# Install tmux, to manage terminal sessions, windows, and panes
brew install tmux

# Install neovim, a more modern vim
brew install neovim

# Install yarn, the node package manager
brew install yarn

# Install fzf a command line fuzzy finder
brew install fzf

# Install the silver searcher for finding in files
brew install the_silver_searcher

# Install more recent version of grep, git, openssh, zsh
brew install grep
brew install git
brew install openssh
brew install zsh

# Install zsh plugin manager
brew install zplug

# Install vlc media player
brew install vlc

# Install terminal emulator iterm2 
brew cask install iterm2

# Install password manager
brew cask install 1password

# Install caffeine, an app that stops your mac sleeping while active
brew cask install caffeine

# Install cakebrew, a handy GUI for homebrew
brew cask install cakebrew

# Install dropbox, for managing files across devices
brew cask install dropbox

# Install flux, an app that warms screen colours at night to aid sleep
brew cask install flux

# Install imageoptim, an image file size reducer (reduces metadata etc)
brew cask install imageoptim

# Install kapako, an ambient sound mixer / player
brew cask install kapako

# Install little snitch, to keep an eye on your network
brew cask install little-snitch

# Install slate, a window position manager
brew cask install slate

# Install some browsers for testing
brew cask install firefox
brew cask install google-chrome
# Clean up brew, the '-s' option clears the cache, including latest versions
brew cleanup -s

# Clean up brew cask
brew cask cleanup

# Set zsh as default shell
sudo -s 'echo /usr/local/bin/zsh >> /etc/shells' && chsh -s /usr/local/bin/zsh
